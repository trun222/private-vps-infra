{
  email thomas@scalor.app
  servers {
    protocols h1 h2 h3
  }
}

############################################
# PUBLIC - Polyport (scalor.app)
############################################

scalor.app {
  encode zstd gzip
  reverse_proxy polyport-web:3000
}

api.scalor.app {
  encode zstd gzip
  reverse_proxy polyport-api:3001
}

############################################
# PUBLIC - ArchitectWorks (architectworks.scalor.app)
############################################

architectworks.scalor.app {
  encode zstd gzip
  reverse_proxy architectworks-web:3000
}

api.architectworks.scalor.app {
  encode zstd gzip
  reverse_proxy architectworks-api:3001
}

############################################
# PRIVATE / INTERNAL ROUTES (Tailscale only)
############################################

(ts_allowlist) {
  @allowed remote_ip 100.64.0.0/10 127.0.0.1/32 ::1 172.16.0.0/12 192.168.0.0/16
}

grafana.dev.internal {
  tls internal
  encode zstd gzip
  import ts_allowlist
  handle @allowed {
    reverse_proxy grafana:3000
  }
  respond "Forbidden" 403
}

prometheus.dev.internal {
  tls internal
  import ts_allowlist
  handle @allowed {
    reverse_proxy prometheus:9090
  }
  respond "Forbidden" 403
}

loki.dev.internal {
  tls internal
  import ts_allowlist
  handle @allowed {
    reverse_proxy loki:3100
  }
  respond "Forbidden" 403
}

n8n.dev.internal {
  tls internal
  encode zstd gzip
  import ts_allowlist
  handle @allowed {
    reverse_proxy n8n:5678
  }
  respond "Forbidden" 403
}
